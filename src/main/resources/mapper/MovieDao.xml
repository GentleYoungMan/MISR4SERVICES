<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.soecode.osc.dao.MovieDao">
    <!-- 目的：为dao接口方法提供sql语句配置 -->
    <resultMap id="Movie" type="Movie">
        <id column="movie_id" property="movieId"></id>
        <result column="title" property="title"></result>
        <result column="run_time" property="runtime"></result>
        <result column="original_title" property="originalTitle"></result>
        <result column="child_protection_display_name" property="childProtectionDisplayName"></result>
        <result column="child_protection_id" property="childProtectionId"></result>
        <result column="child_protection_level" property="childProtectionLevel"></result>
        <result column="countries" property="countries"></result>
        <result column="main_genre" property="mainGenre"></result>
        <result column="long_description" property="longDescription"></result>
        <result column="year" property="year"></result>
        <result column="category" property="category"></result>
        <result column="creation_date" property="creationDate"></result>
    </resultMap>

    <!-- 分页查询 -->
    <select id="getMoviesWithTabs" resultMap="Movie">
        SELECT
        *
        FROM
        tmovies
        LIMIT
        #{offset},
        #{size}
    </select>

    <insert id="insertDao">
        INSERT
        ignore
        INTO  tmovies
        (title,
        run_time,
        original_title,
        child_protection_display_name,
        child_protection_id,
        child_protection_level,
        countries,
        main_genre,
        long_description,
        year,
        category,
        creation_date)
        VALUES (
        #{title},
        #{runtime},
        #{originalTitle},
        #{childProtectionDisplayName},
        #{childProtectionId},
        #{childProtectionLevel},
        #{countries},
        #{mainGenre},
        #{longDescription},
        #{year},
        #{category},
        #{creationDate}
        )
    </insert>

    <delete id="deleteDao">
        DELETE
        FROM
        tmovies
        WHERE
        movie_id = #{moviesId}
    </delete>

    <update id="updateDao">
        UPDATE
        tmovies
        SET
        title =#{title},
        run_time =#{runtime},
        original_title=#{originalTitle},
        child_protection_display_name=#{childProtectionDisplayName},
        child_protection_id=#{childProtectionId},
        child_protection_level=#{childProtectionLevel},
        countries=#{countries},
        main_genre=#{mainGenre},
        long_description=#{longDescription},
        year=#{year},
        category=#{category},
        creation_date=#{creationDate}
        WHERE
        movie_id=#{movieId}
    </update>

    <select id="getMovieById" resultMap="Movie">
        SELECT *
        FROM
        tmovies
        WHERE
        movie_id = #{movieId}
    </select>

    <select id="fuzzyMoviesByName" resultMap="Movie">
        SELECT *
        FROM
        tmovies
        WHERE
        title
        LIKE
        concat(concat('%',#{movieTitles},'%'))
    </select>

    <select id="countMovie" resultType="Integer">
        SELECT
        COUNT(1)
        FROM
        tmovies
    </select>
</mapper>